!function(){var Parser,el,read,resetReveal,showError;el={input:$("#input"),sim:$("#sim")};Parser=function(){var MOD,reBegin,reBlockClose,reBlockOpen,reEnd,reForward,reLeft,reRepeat,reRight,reValue,reWS;reBegin=/^begin/;reBlockOpen=/^\[/;reBlockClose=/^\]/;reEnd=/^end/;reForward=/^forward/;reLeft=/^left/;reRepeat=/^repeat/;reRight=/^right/;reValue=/^[1-9][0-9]*/;reWS=/^\s+/;MOD=1000003;function Parser(prg){this.prg=prg;this.from=0;this.to=0;this.stack=[];this.match=null;this.idx=0}Parser.prototype.read=function(re){var _ref;if(this.match=(_ref=this.prg.substr(this.idx).match(re))!=null?_ref[0]:void 0){this.idx+=this.match.length;return true}return false};Parser.prototype.readStrict=function(re){if(!this.read(re)){throw new Error("Expected to match "+re+" at "+this.idx)}};Parser.prototype.readValue=function(){this.readStrict(reValue);return parseInt(this.match,10)};Parser.prototype.mod=function(x){if(x<MOD){return x}else{return x%MOD}};Parser.prototype.next=function(){var p,rep,retVal,top;this.read(reWS);retVal=true;if(this.read(reBegin)){this.stack.push({fw:0,lt:0,rt:0,rep:1})}else if(this.read(reBlockClose)){p=this.stack.pop();p.fw=this.mod(p.fw*p.rep);p.lt=this.mod(p.lt*p.rep);p.rt=this.mod(p.rt*p.rep);top=this.stack.slice(-1)[0];top.fw=this.mod(top.fw+p.fw);top.lt=this.mod(top.lt+p.lt);top.rt=this.mod(top.rt+p.rt)}else if(this.read(reEnd)){this.stack.pop();retVal=false}else if(this.read(reForward)){this.readStrict(reWS);top=this.stack.slice(-1)[0];top.fw=this.mod(top.fw+this.readValue())}else if(this.read(reLeft)){this.readStrict(reWS);top=this.stack.slice(-1)[0];top.lt=this.mod(top.lt+this.readValue())}else if(this.read(reRepeat)){this.readStrict(reWS);rep=this.readValue();this.readStrict(reWS);this.readStrict(reBlockOpen);this.stack.push({fw:0,lt:0,rt:0,rep:rep})}else if(this.read(reRight)){this.readStrict(reWS);top=this.stack.slice(-1)[0];top.rt=this.mod(top.rt+this.readValue())}else{throw new Error("No valid token at "+this.idx)}this.from=this.to;this.to=this.idx;return retVal};Parser.prototype.render=function(){var ctx,fnElem,i,prg,section,stk,_i,_ref;prg=this.prg.substring(0,this.from);prg+="<strong>";prg+=this.prg.substring(this.from,this.to);prg+="</strong>";prg+=this.prg.substring(this.to);if(this.stack.length===0){stk="<em>Vacía</em>"}else{stk="";for(i=_i=_ref=this.stack.length-1;_ref<=0?_i<=0:_i>=0;i=_ref<=0?++_i:--_i){ctx=this.stack[i];fnElem=function(key){return'<span class="elem">\n	<span class="key">'+key+':</span>\n	<span class="val">'+ctx[key]+"</span>\n</span>"};stk+='<div class="stack-block">\n	'+fnElem("fw")+"\n	"+fnElem("lt")+"\n	"+fnElem("rt")+"\n	"+fnElem("rep")+"\n</div>"}}section=$("<section>\n	<table>\n		<tr>\n			<th>Programa</th>\n			<th>Pila</th>\n		</tr>\n		<tr>\n			<td><pre>"+prg+"</pre></td>\n			<td>"+stk+"</td>\n		</tr>\n	</table>\n</section>");return el.sim.append(section)};return Parser}();showError=function(msg){el.sim.empty();return el.sim.append($("<h2>Ups..</h2>\n<p>Parece que hubo un error en el análisis sintáctico del programa</p>\n<pre>"+msg+"</pre>\n<p>Verifique el código fuente, e intente de nuevo</p>"))};read=function(){var e,parser;parser=new Parser(el.input.val());el.sim.empty();parser.render();try{while(parser.next()){parser.render()}return parser.render()}catch(_error){e=_error;return showError(e.message)}};resetReveal=function(){read();return Reveal.initialize({controls:true,progress:true,keyboard:true,slideNumber:true})};$(function(){el.input.val("begin\n  forward 20\n  left 45\n  repeat 4 [\n    forward 10\n    right 90\n  ]\n  right 45\nend");resetReveal();return $("#go").on("click",function(){return resetReveal()})})}.call(this);